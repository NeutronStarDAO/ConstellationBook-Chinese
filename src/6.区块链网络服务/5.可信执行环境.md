## 可信执行环境 TEE

可信执行环境（Trusted Execution Environment，TEE）是 CPU 内的一个安全区域，运行在一个独立的环境中，与操作系统并行运行。

当苹果于 2013 年发布 iPhone 5S 时，大多数人关注新相机和 Touch ID 等功能。

然而在这些功能之上，苹果引入了一个被认为对密码学世界具有深远影响的概念。作为 Touch ID 的基础，安全飞地处理器（SEP）被呈现为一个独立的子处理器，用来存储敏感数据并在其上运行计算机程序。这些敏感数据无法被常规 APP 访问。苹果对其设计和内部运作保密，仅发布了有限的内部信息。

此后不久，英特尔也开始提供一种名为英特尔软件保护扩展（SGX）的功能，承诺即使在使用过程中也能保持数据加密。不久之后，AMD 推出了类似的产品，甚至亚马逊 AWS 也开发了自己的基于软件的安全飞地。尽管这 4 个产品存在一些显著差异，但它们都专注于保护正在使用的数据，针对略有不同的用例。

目前的 TEE 在不同 CPU 上有不同的实现方案，在 Intel 的 CPU 上实现 TEE 的技术方案叫 SGX ，全称为 Intel Software Guard Extension 。AMD 的 SEV 方案。在 ARM 架构的 CPU 上实现 TEE 的技术方案叫 TrustZone ，但是由于 ARM 架构的开放性，各大厂商在进行定制的时候会采用不同的方案。

<br>

### 保险箱

CPU 会确保 TEE 里的代码和数据既保密又完整。TEE 最厉害的地方在于它能和电脑系统隔离开来，就像是在电脑里设了个小保险柜，不让坏人轻松捣乱。里面有你的密码、支付信息这些重要的东西。所以，就算电脑被病毒攻击了，这些重要的信息还是安然无恙。

TEE有自己的 “ 执行空间 ” ，也就是说，它用的东西和我们平时的操作系统是分开的。在 TEE 里，有一些受信任的应用程序，它们可以访问设备的一些重要部分。硬件隔离的任务就是保护 TEE 不受系统中普通 APP 的影响。 TEE 内部的代码和数据在执行过程中受到严格的保护。

TEE 通常提供加密和数字签名等安全机制，以确保代码和数据的完整性，同时通过安全协议确保通信的机密性。这使得TEE成为存储和处理敏感信息的理想场所。

<br>

在 TEE 启动的时候，要经过一系列验证，确保整个系统都是安全的。比如，先加载一些安全引导程序，再逐步验证安全操作系统启动过程中的关键代码，以保证 TEE 里的一切都是安全的。

TEE 具有自身的执行空间，它所能访问的软硬件资源与操作系统是分离的。TEE 为授权安全软件或可信安全软件（Trust App）提供了安全的执行环境，保护了其数据和资源的保密性、完整性和访问权限。TEE 在启动时为了保证整个系统的安全，从系统引导启动开始逐步验证以保证 TEE 平台的完整性。当设备加电后，TEE 首先加载 ROM 中的安全引导程序，并利用根密钥验证其完整性。

然后，该引导程序进入 TEE 初始化阶段并启动 TEE 内置的安全操作系统，逐级核查安全操作系统启动过程中的各个阶段的关键代码以保证安全操作系统的完整性，同时防止未授权或经过恶意篡改的软件的运行。安全操作系统启动后，运行非安全世界的引导程序并启动普通操作系统。至此基于信任链，TEE 完成了整个系统的安全启动，能够有效抵御 TEE 启动过程中的非法篡改、代码执行等恶意行为。

<br>

过去几年中，使用中的加密在安全和隐私社区中是一个非常热门的话题。与任何相对热门的话题一样，会出现多种解决方案来解决手头的问题。在隐私/安全领域，这些解决方案被称为隐私增强技术（PETs），而安全飞地是由于其易用性、可用性和性能而在行业中得到最广泛应用的解决方案。

<br>

### 用途

TEE 的应用范围非常广泛，涵盖了多个领域。其中之一是安全支付，TEE 可以用于保护支付应用程序中的交易信息，防止恶意软件和攻击者窃取用户的财务数据。另一个重要的应用领域是物联网（IoT），TEE 可以保护嵌入式设备中的敏感信息，防止未经授权的访问和控制。

在云计算中，TEE 也发挥着重要作用。通过在云服务中引入 TEE ，用户可以在云端运行代码和处理数据，同时确保其隐私和安全。这为云计算提供了更高的安全性，吸引了许多企业和组织采用云服务。

而且，TEE 还会融入更多新潮的技术，比如人工智能和区块链，给它增加更多的功能。

IC 做为去中心化云服务，使用 TEE 可以增强对子网数据的保护，使链上隐私进一步增强。即使是节点运营商也不知道节点机器里在运行了什么数据。

<br>

随着数字化进程的不断推进，TEE 将继续发挥重要作用，并在未来得到进一步发展。一方面，硬件隔离技术将变得更加先进，提供更强大的保护机制。另一方面，TEE 将更多地融入新兴技术，如人工智能和区块链，为这些领域提供更可靠的安全基础。

同时，TEE 在标准化和跨平台兼容性方面可能会面临挑战。为了更广泛地推广 TEE 技术，行业需要制定一致的标准，以确保不同厂商和设备之间的互操作性。

可信执行环境作为一种关键的安全技术，为数据安全和隐私提供了强大的保护。其原理基于硬件隔离和安全执行，应用范围广泛，涵盖了支付、物联网、云计算等多个领域。未来，随着技术的不断进步，TEE 将继续发挥重要作用，并在新兴技术领域展现更广阔的前景。

<br>
